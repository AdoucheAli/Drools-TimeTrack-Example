#created on: Feb 11, 2010
package com.jboss.example



rule "CBU072_Accumulation_QualifierRule"
	when
		# 1. If the time slice is Inside Schedule,
		# 2. And the time slice is not generated by Blaze,
		$slice : TimeSlice(
			sliceCreatedByRules  == false, 
			classifiers contains(TimeSliceClassifiers.INSIDE_SCHEDULE)
			)			
	then 
		# 3. Then proceed into the ruleset, otherwise exit.
		System.out.println("Accumulators");	
		drools.getWorkingMemory().setFocus("Accumulators");
		
		
end

rule "CBU072_InsideSchedule_worked_Accumulation_Rule"
agenda-group "Accumulators"

	when

		$employee: Employee( $schedule:schedule )
		WeeklyAccumulator( 
			this == $schedule, 
			$OT: weeklyHoursTowardsOT , 
			$FLSA: weeklyHoursTowardsFLSA 
			)

		$slice:  TimeSlice( 
					classifiers contains(TimeSliceClassifiers.WORKED), 
					employee == $employee,
					$elapsed: elapsed
					)

	then 
				
		#Add the duration of the time slice to the weekly overtime threshold,
		$OT += $elapsed;
			
		#Add the duration of the time slice to the weekly FLSA threshold.		
		$FLSA +=  $elapsed;
		
end

/*
1. If the time slice is Absence,
2. And the time slice is Count to OT,
3. And the time slice is Count to FLSA, 
4. Then add the duration of the time slice to the weekly overtime threshold,
5. And add the duration of the time slice to the weekly FLSA threshold.

*/
rule "CBU072_InsideSchedule_ExcusedAbsence_Accumulation_Rule"
agenda-group "Accumulators"

	when
	
		$employee: Employee( $schedule:schedule )

		WeeklyAccumulator( 
			this == $schedule, 
			$OT: weeklyHoursTowardsOT , 
			$FLSA: weeklyHoursTowardsFLSA 
			)

		$slice:  TimeSlice( 
					classifiers contains(TimeSliceClassifiers.ABSENCE), 
					classifiers contains(TimeSliceClassifiers.COUNT_TO_OT),
					classifiers contains(TimeSliceClassifiers.COUNT_TO_FLSA),
					employee == $employee,
					$elapsed: elapsed
					)
	then

		#Add the duration of the time slice to the weekly overtime threshold,
		$OT += $elapsed;
			
		#Add the duration of the time slice to the weekly FLSA threshold.		
		$FLSA +=  $elapsed;

end



rule "CBU072_InsideSchedule_Absence_Accumulation_Rule"
	when
		$employee: Employee( $schedule:schedule )

		WeeklyAccumulator( 
			this == $schedule, 
			$OT: weeklyHoursTowardsOT , 
			$FLSA: weeklyHoursTowardsFLSA 
			)

		$slice:  TimeSlice( 
					classifiers contains(TimeSliceClassifiers.ABSENCE), 
					classifiers contains(TimeSliceClassifiers.COUNT_TO_OT),
					classifiers not contains TimeSliceClassifiers.COUNT_TO_FLSA,
					employee == $employee,
					$elapsed: elapsed
					)
	 
	then


		#Add the duration of the time slice to the weekly overtime threshold,
		$OT += $elapsed;
	

end


